!function(){"use strict";function e(e){try{return e.getAdPodInfo()}catch(e){return null}}var t="dai",i="adError",a=".jw-slider-time",n=".jw-media",r="jw-flag-ads",o=(function(){function e(e){this.value=e}function t(t){function i(n,r){try{var o=t[n](r),s=o.value;s instanceof e?Promise.resolve(s.value).then(function(e){i("next",e)},function(e){i("throw",e)}):a(o.done?"return":"normal",o.value)}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):r=null}var n,r;this._invoke=function(e,t){return new Promise(function(a,o){var s={key:e,arg:t,resolve:a,reject:o,next:null};r?r=r.next=s:(n=r=s,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),s={adcounterdynamic:"Ad __AD_POD_CURRENT__ of __AD_POD_LENGTH__. ",admessage:"This ad will end in xx",cuetext:"Advertisement",debug:!1,cmsID:"",videoID:"",apiKey:""},l=function e(t,i){o(this,e),this.config=t,this.utils=i;for(var a in s)if(s.hasOwnProperty(a)){var n=t[a],r=s[a],l=typeof r;if(void 0!==n){if("boolean"!==l&&"number"!==l||(n=function(e){if("true"===e)return!0;if("false"===e)return!1;var t=parseFloat(e);return isNaN(t)?e:t}(n)),typeof n!==l)throw new Error("invalid parameter: "+a+" should be a "+l);this[a]=n}else this[a]=r}},d=null,c=function(e){if(d)return d;var t=["//","imasdk.googleapis.com/js/sdkloader/ima3_dai.js"];return"file:"===document.location.protocol&&t.unshift("https:"),d=new Promise(function(i,a){if(window.google&&google.ima&&google.ima.dai)i();else{new e.scriptloader(t.join("")).on("complete",function(){i(google.ima)}).on("error",function(e){return a(e)}).load()}})},u={},h=function(e,t){var i=this,a=u[t];return a||(function(e,t){e.jwplayerEntitlements=function(e,t,i){var a={canPlayAds:!0},n=new e.key(t),r=n.edition();if("unlimited"===r)return i(a);var o=n.token(),s=["//","entitlements.jwplayer.com","/",o,".json"];"file:"===window.location.protocol&&s.unshift("https:"),e.ajax(s.join(""),function(e){a.canPlayAds=!e||!e.response||!1!==e.response.canPlayAds,i(a)},function(){i(a)},{timeout:1e4,responseType:"json"})}}(this),u[t]=new Promise(function(a,n){i.jwplayerEntitlements(e,t,function(e){e.canPlayAds?a():n({message:"Ad Limit Reached"})})}))},m=function(){function e(t,i,r,s){o(this,e),r.utils.extend(this,r.Events),this.adCues=[],this.item=t,this.options=i,this.player=r,this.env=r.getEnvironment(),this.utils=r.utils,this.daiUtils=s,this.blockingInstreamPlayer=null,this.timeoutAdStart=-1,this.playerContainer=r.getContainer(),this.playerTimeSlider=this.playerContainer.querySelector(a),this.video=r.getContainer().querySelector("video"),this.streamEventHandler=this.onStreamEvent.bind(this),this.clickElement=this.env.OS.mobile?document.createElement("div"):this.playerContainer.querySelector(n),r.on("time",this.checkMidrolls,this)}return e.prototype.init=function(){var e=this;this.initAdsManagerPromise=c().then(function(){return e.destroyed()?null:(e.streamManager=new google.ima.dai.api.StreamManager(e.video),e.streamManager.setClickElement(e.clickElement),e.streamManagerEvents=[google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED,google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED,google.ima.dai.api.StreamEvent.Type.AD_PROGRESS,google.ima.dai.api.StreamEvent.Type.CLICK,google.ima.dai.api.StreamEvent.Type.COMPLETE,google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED,google.ima.dai.api.StreamEvent.Type.ERROR,google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE,google.ima.dai.api.StreamEvent.Type.LOADED,google.ima.dai.api.StreamEvent.Type.MIDPOINT,google.ima.dai.api.StreamEvent.Type.STARTED,google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE],e.streamManager.addEventListener(e.streamManagerEvents,e.streamEventHandler,!1),new Promise(function(t,i){e.daiStreamLoaded=t,e.daiStreamFailed=i}))}).catch(function(e){return Promise.reject(e)})},e.prototype.onStreamEvent=function(e){var t=this,a=this.daiUtils.adEventObject(e.getAd());switch(e.type){case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:this.setAdsMode(!1);break;case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:this.setAdsMode(!0);break;case google.ima.dai.api.StreamEvent.Type.AD_PROGRESS:this.adProgress(e.getStreamData().adProgressData,a);break;case google.ima.dai.api.StreamEvent.Type.CLICK:this.trigger("adClick",a),this.player.pause(),setTimeout(function(){t.player.pause()},0);break;case google.ima.dai.api.StreamEvent.Type.COMPLETE:this.trigger("adComplete",a);break;case google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED:var n=this.adCues=e.getStreamData().cuepoints;if(n&&n.length){var r=n.filter(function(e){return e.start>0}).map(function(e){return{begin:e.start,text:t.options.cuetext}});this.player.setCues([]),this.player.setCues(r)}break;case google.ima.dai.api.StreamEvent.Type.ERROR:var o=e.getStreamData().errorMessage,s=this.utils.extend({id:"-1",message:"Ad Error: "+o},a);this.trigger(i,s);break;case google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE:break;case google.ima.dai.api.StreamEvent.Type.LOADED:clearTimeout(this.timeoutAdStart),this.daiStreamLoaded(e.getStreamData());break;case google.ima.dai.api.StreamEvent.Type.MIDPOINT:break;case google.ima.dai.api.StreamEvent.Type.STARTED:this.trigger("adImpression",a);var l=this.player.getState();"playing"===l&&this.trigger("adPlay",{oldstate:"unknown",newstate:l});break;case google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE:}},e.prototype.prepareToPlayAd=function(){this.destroyed()||this.blockingInstreamPlayer||(clearTimeout(this.timeoutAdStart),this.mobileSafeStartBlocking())},e.prototype.startBlocking=function(){var e=this;this.blockingInstreamPlayer||this.destroyed()||(this.blockingInstreamPlayer=this.player.createInstream().init(),this.blockingInstreamPlayer.setText("Loading"),this.initAdsManagerPromise.then(function(t){e.loadStream(t)}).catch(function(){e.stopBlocking()}),clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout(function(){e.destroyed()||e.stopBlocking()},"3000"))},e.prototype.mobileSafeStartBlocking=function(){var e=this.player.getConfig().mediaElement,t=this.player.isBeforePlay()||0===this.player.getPosition(),i=this.env.Browser.safari&&this.env.Browser.version.major>=11||this.env.OS.mobile&&!!e.src;t&&i&&e.load(),this.startBlocking()},e.prototype.stopBlocking=function(){this.destroyed()||(clearTimeout(this.timeoutAdStart),this.destroyBlockingInstreamPlayer())},e.prototype.loadStream=function(e){var t=this.player.getPlaylistItem(this.player.getPlaylistIndex()),i=e.url;t.sources=[this.utils.extend(t.sources[0],{file:i})],this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.replacePlaylistItem(t),this.destroyBlockingInstreamPlayer())},e.prototype.checkMidrolls=function(e){if(this.adCues.length){for(var t=e.position,i=-1,a=0;a<this.adCues.length&&!(this.adCues[a].start>t);a++)i=a;i>-1&&!this.adCues[i].played&&t!==this.adCues[i].start&&(this.playerPositionBeforeMidroll=t,this.player.seek(this.adCues[i].start))}},e.prototype.handlePlayPause=function(){var e=this;this.player.on("play",function(t){var i={};i.oldstate=t.oldstate,i.newstate=t.newstate,e.trigger("adPlay",i)},this),this.player.on("pause",function(t){var i={};i.oldstate=t.oldstate,i.newstate=t.newstate,e.trigger("adPause",i)},this)},e.prototype.setAdsMode=function(e){var t=this;e?(this.utils.addClass(this.playerTimeSlider,"jw-hidden"),this.utils.addClass(this.playerContainer,r),this.handlePlayPause(),this.blockingInstreamPlayer||(this.blockingInstreamPlayer=this.player.createInstream()),this.env.OS.mobile&&(this.blockingInstreamPlayer.addClickHandler(),this.blockingInstreamPlayer.off(null,null,this),this.blockingInstreamPlayer.on("instreamClick",function(){"paused"===t.player.getState()?t.player.play():t.clickElement.click()},this))):(this.utils.removeClass(this.playerTimeSlider,"jw-hidden"),this.utils.removeClass(this.playerContainer,r),this.player.off("play",null,this),this.player.off("pause",null,this),this.destroyBlockingInstreamPlayer(),this.playerPositionBeforeMidroll&&(this.player.seek(this.playerPositionBeforeMidroll),this.playerPositionBeforeMidroll=null))},e.prototype.beforePlay=function(){var e=this;this.player.off("beforePlay",null,this),this.prepareToPlayAd(),c().then(function(){if(!e.destroyed()){var t=new google.ima.dai.api.VODStreamRequest;t.contentSourceId=e.options.cmsID,t.videoId=e.options.videoID,t.apiKey=e.options.apiKey,e.streamManager.requestStream(t)}})},e.prototype.adProgress=function(e,t){if(this.blockingInstreamPlayer){var i=e.adPosition,a=e.currentTime,n=e.duration,r=e.totalAds,o=this.options.admessage||"",s=this.options.adcounterdynamic||"";o=o.replace(/xx/gi,""+Math.ceil(n-a)),r>1&&(o=(s=(s=s.replace(/__AD_POD_CURRENT__/g,""+i)).replace(/__AD_POD_LENGTH__/g,""+r))+o),this.blockingInstreamPlayer.setText(o),t.position=a,t.duration=n,this.trigger("adTime",t)}},e.prototype.destroyBlockingInstreamPlayer=function(){this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(null,null,this),this.blockingInstreamPlayer.setText(""),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null)},e.prototype.destroy=function(){this.off(),this.player.off(null,null,this),clearTimeout(this.timeoutAdStart),this.destroyed()||(this.streamManager&&this.streamManager.removeEventListener(this.streamManagerEvents,this.streamEventHandler,!1),this.options=null,this.video=null,this.daiStreamFailed("DAI ad plugin destroyed"),this.daiStreamFailed=null,this.daiStreamLoaded=null,this.initAdsManagerPromise=null,this.destroyBlockingInstreamPlayer(),this.player=null,this.item=null)},e.prototype.destroyed=function(){return!this.item},e}(),p=function(){function i(e){o(this,i),this.player=e,this.adIds={}}return i.prototype.getAdId=function(t){if(t){var i=t.getAdId(),a=e(t);if(a&&(i=""+a.getTimeOffset()),i)return void 0===this.adIds[i]&&(this.adIds[i]=function(e){return new Array(e+1).join((Math.random().toString(36)+"00000000000000000").slice(2,18)).slice(0,e)}(12)),this.adIds[i]}return UNKNOWN_AD_ID},i.prototype.adEventObject=function(i){var a={client:t};if(!i)return a;a.id=this.getAdId(i),a.adtitle=i.getTitle(),a.adsystem=i.getAdSystem(),a.creativetype="application/x-mpegURL",a.linear="linear",a.viewable=this.player.getViewable();var n=e(i);if(n){var r=n.getTotalAds();r>1&&(a.sequence=n.getAdPosition(),a.podcount=r);var o=n.getTimeOffset(),s="mid";0===o?s="pre":-1===o&&(s="post"),a.adposition=s}return a},i}();(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(t,"8.0",function(e,a){function n(){e.off("ready",n,this),e.getAdBlock()&&e.trigger(i,{client:t,id:"unknown",message:"Ad playback blocked by an ad blocker"})}function r(){g&&!g.destroyed()&&(e.off(null,null,g),g.destroy(),g=null)}var o=this,s=e.utils,d=e.getConfig(),u=new l(a||{},s),y=new p(e),g=void 0,f=void 0;e.once("ready",function(){f=!0},this),c(s).catch(function(){f?n():(e.off("ready",n,o),e.once("ready",n,o))});var v=d.key;this.version="0.1.2",s.extend(this,e.Events),e.on("playlistItem",function(t){var i=t.item;!function(t,i){r(),(g=new m(t,i,e,y)).init(i),g.on("all",function(t,i){return e.trigger(t,i)}),e.once("beforePlay",function(e){g.beforePlay(e)},g)}(i,s.extend({},u,i.daiSetting))},this),e.on("destroyPlugin",function(){o.destroy()}),h.call(this,s,v).catch(function(a){o.destroy(),e.trigger(i,{id:"-1",client:t,message:"Ad Error: "+a.message,code:900,tag:""})}),this.destroy=function(){r(),e.off(null,null,o)}})}();
